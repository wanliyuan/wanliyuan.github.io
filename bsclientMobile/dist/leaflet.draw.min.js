L.LatLngUtil={cloneLatLngs:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(this.cloneLatLng(a[c]));return b},cloneLatLng:function(a){return L.latLng(a.lat,a.lng)}},L.DrawTouch=L.Class.extend({includes:L.Mixin.Events,initialize:function(a){this._map=a},enable:function(){this._enabled||(this._map&&L.DomEvent.addListener(this._map._container,"touchstart",this._onTouchStart,this),this._enabled=!0)},disable:function(){this._enabled&&(this._map&&L.DomEvent.removeListener(this._map._container,"touchstart",this._onTouchStart,this),this._enabled=!1)},_normaliseEvent:function(a){L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection();var b=a.touches?a.touches[0]:a,c=this._map.mouseEventToContainerPoint(b),d=this._map.mouseEventToLayerPoint(b),e=this._map.layerPointToLatLng(d);return{latlng:e,layerPoint:d,containerPoint:c,clientX:b.clientX,clientY:b.clientY,originalEvent:a}},_onTouchStart:function(a){1===a.touches.length&&(this.fire("down",this._normaliseEvent(a)),L.DomEvent.addListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this))},_onTouchMove:function(a){this.fire("move",this._normaliseEvent(a))},_onTouchEnd:function(){this.fire("up"),L.DomEvent.removeListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this)}}),L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(a,b){this._map=a,this._container=a._container,this._overlayPane=a._panes.overlayPane,this._popupPane=a._panes.popupPane,b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions)),L.setOptions(this,b)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus(),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(a){L.setOptions(this,a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){27===a.keyCode&&this.disable()}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(a,b){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(a){var b=a.latlng;this._mouseMarker.setLatLng(b),this._marker?(b=this._mouseMarker.getLatLng(),this._marker.setLatLng(b)):(this._marker=new L.Marker(b,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var a=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}}),L.Draw.MarkerTouch=L.Draw.Marker.extend({initialize:function(a,b){L.Draw.Marker.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Marker.prototype.addHooks.call(this),this._touchable||(this._touchable=new L.DrawTouch(this._map)),this._map&&(console.dir(this._touchable),this._touchable.on({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).enable())},removeHooks:function(){L.Draw.Marker.prototype.removeHooks.call(this),this._map&&this._touchable.off({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).disable()},_onTouchStart:function(a){this._currentLatLng=a.latlng,this._touchOriginPoint=L.point(a.clientX,a.clientY),this._map.off("mousemove",this._onMouseMove,this)},_onTouchMove:function(a){this._touchOriginPoint&&(this._touchEndPoint=L.point(a.clientX,a.clientY))},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&(this._marker=new L.Marker(this._currentLatLng,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._onClick())}else this._marker=new L.Marker(this._currentLatLng,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._onClick();this._map.on("mousemove",this._onMouseMove,this),this._touchOriginPoint=null,this._currentLatLng=null,this._touchEndPoint=null}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(10,10),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,zIndexOffset:2e3},initialize:function(a,b){b&&b.drawError&&(b.drawError=L.Util.extend({},this.options.drawError,b.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var a=this._markers.pop(),b=this._poly,c=this._poly.spliceLatLngs(b.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(a),b.getLatLngs().length<2&&this._map.removeLayer(b),this._vertexChanged(c,!1)}},addVertex:function(a){this._markers.push(this._createMarker(a)),this._poly.addLatLng(a),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(a,!0)},_finishShape:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(a){var b=a.layerPoint,c=a.latlng;this._currentLatLng=c,this._updateGuide(b),this._mouseMarker.setLatLng(c),L.DomEvent.preventDefault(a.originalEvent)},_vertexChanged:function(){this._updateFinishHandler(),this._clearGuides()},_onMouseDown:function(a){var b=a.originalEvent;this._mouseDownOrigin=L.point(b.clientX,b.clientY)},_onMouseUp:function(a){if(this._mouseDownOrigin){var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(b)<9*(window.devicePixelRatio||1)&&this.addVertex(a.latlng)}this._mouseDownOrigin=null},_updateFinishHandler:function(){var a=this._markers.length;a>1&&this._markers[a-1].on("click",this._finishShape,this),a>2&&this._markers[a-2].off("click",this._finishShape,this)},_createMarker:function(a){var b=new L.Marker(a,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(b),b},_updateGuide:function(a){var b=this._markers.length;b>0&&(a=a||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[b-1].getLatLng()),a))},_drawGuide:function(a,b){var c,d,e,f=Math.floor(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))),g=this.options.guidelineDistance,h=this.options.maxGuideLineLength,i=f>h?f-h:g;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));f>i;i+=this.options.guidelineDistance)c=i/f,d={x:Math.floor(a.x*(1-c)+c*b.x),y:Math.floor(a.y*(1-c)+c*b.y)},e=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),e.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(e,d)},_updateGuideColor:function(a){if(this._guidesContainer)for(var b=0,c=this._guidesContainer.childNodes.length;c>b;b++)this._guidesContainer.childNodes[b].style.backgroundColor=a},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var a=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}}),L.Draw.PolylineTouch=L.Draw.Polyline.extend({initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Polyline.prototype.addHooks.call(this),this._touchable||(this._touchable=new L.DrawTouch(this._map)),this._map&&this._touchable.on({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).enable()},removeHooks:function(){L.Draw.Polyline.prototype.removeHooks.call(this),this._map&&this._map&&this._touchable.off({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).disable()},_updateFinishHandler:function(){L.Draw.Polyline.prototype._updateFinishHandler.call(this);var a,b,c=this._markers.length,d=this._map.containerPointToLatLng([0,0]).distanceTo(this._map.containerPointToLatLng([0,1]));c>2&&(a=this._markers[c-2].getLatLng().distanceTo(this._markers[c-1].getLatLng()),b=Math.floor(a/d),b<12*(window.devicePixelRatio||1)&&(this.deleteLastVertex(),this._finishShape()))},_onTouchStart:function(a){this._currentLatLng=a.latlng,this._touchOriginPoint=L.point(a.clientX,a.clientY),this._map.off("mousemove",this._onMouseMove,this)},_onTouchMove:function(a){this._touchOriginPoint&&(this._touchEndPoint=L.point(a.clientX,a.clientY))},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&this.addVertex(this._currentLatLng)}else this.addVertex(this._currentLatLng);this._map.on("mousemove",this._onMouseMove,this),this._touchOriginPoint=null,this._touchEndPoint=null}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;a>3&&(this._markers[0].on("click",this._finishShape,this),this._markers[a-1].on("dblclick",this._finishShape,this),a>3&&this._markers[a-2].off("dblclick",this._finishShape,this))},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(a,b){var c;!this.options.allowIntersection&&this.options.showArea&&(c=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(c)),L.Draw.Polyline.prototype._vertexChanged.call(this,a,b)},_cleanUpShape:function(){var a=this._markers.length;a>0&&(this._markers[0].off("click",this._finishShape,this),a>2&&this._markers[a-1].off("dblclick",this._finishShape,this))}}),L.Draw.PolygonTouch=L.Draw.Polygon.extend({initialize:function(a,b){L.Draw.Polygon.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Polygon.prototype.addHooks.call(this),this._touchable||(this._touchable=new L.DrawTouch(this._map)),this._map&&this._touchable.on({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).enable()},removeHooks:function(){L.Draw.Polygon.prototype.removeHooks.call(this),this._map&&this._map&&this._touchable.off({down:this._onTouchStart,move:this._onTouchMove,up:this._onTouchEnd},this).disable()},_updateFinishHandler:function(){L.Draw.Polygon.prototype._updateFinishHandler.call(this);var a,b,c=this._markers.length,d=this._map.containerPointToLatLng([0,0]).distanceTo(this._map.containerPointToLatLng([0,1]));c>2&&(a=this._markers[0].getLatLng().distanceTo(this._markers[c-1].getLatLng()),b=Math.floor(a/d),b<12*(window.devicePixelRatio||1)&&(this.deleteLastVertex(),this._finishShape()))},_onTouchStart:function(a){this._currentLatLng=a.latlng,this._touchOriginPoint=L.point(a.clientX,a.clientY),this._map.off("mousemove",this._onMouseMove,this)},_onTouchMove:function(a){this._touchOriginPoint&&(this._touchEndPoint=L.point(a.clientX,a.clientY))},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&this.addVertex(this._currentLatLng)}else this.addVertex(this._currentLatLng);this._map.on("mousemove",this._onMouseMove,this),this._touchOriginPoint=null,this._touchEndPoint=null}}),L.EditToolbar=L.EditToolbar||{},L.EditToolbar.Edit=L.Handler.extend({statics:{TYPE:"edit"},includes:L.Mixin.Events,initialize:function(a,b){if(L.Handler.prototype.initialize.call(this,a),this._selectedPathOptions=b.selectedPathOptions,this._featureGroup=b.featureGroup,!(this._featureGroup instanceof L.FeatureGroup))throw new Error("options.featureGroup must be a L.FeatureGroup");this._uneditedLayerProps={},this.type=L.EditToolbar.Edit.TYPE},enable:function(){!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire("draw:editstart",{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disable:function(){this._enabled&&(this._featureGroup.off("layeradd",this._enableLayerEdit,this).off("layerremove",this._disableLayerEdit,this),L.Handler.prototype.disable.call(this),this._map.fire("draw:editstop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(a.getContainer().focus(),this._featureGroup.eachLayer(this._enableLayerEdit,this))},removeHooks:function(){this._map&&(this._featureGroup.eachLayer(this._disableLayerEdit,this),this._uneditedLayerProps={})},revertLayers:function(){this._featureGroup.eachLayer(function(a){this._revertLayer(a)},this)},save:function(){console.log("saving");var a=new L.LayerGroup;this._featureGroup.eachLayer(function(b){b.edited&&(a.addLayer(b),b.edited=!1)}),this._map.fire("draw:edited",{layers:a})},_backupLayer:function(a){var b=L.Util.stamp(a);this._uneditedLayerProps[b]||(this._uneditedLayerProps[b]=a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?{latlngs:L.LatLngUtil.cloneLatLngs(a.getLatLngs())}:a instanceof L.Circle?{latlng:L.LatLngUtil.cloneLatLng(a.getLatLng()),radius:a.getRadius()}:{latlng:L.LatLngUtil.cloneLatLng(a.getLatLng())})},_revertLayer:function(a){var b=L.Util.stamp(a);a.edited=!1,this._uneditedLayerProps.hasOwnProperty(b)&&(a instanceof L.Polyline||a instanceof L.Polygon||a instanceof L.Rectangle?a.setLatLngs(this._uneditedLayerProps[b].latlngs):a instanceof L.Circle?(a.setLatLng(this._uneditedLayerProps[b].latlng),a.setRadius(this._uneditedLayerProps[b].radius)):a.setLatLng(this._uneditedLayerProps[b].latlng))},_toggleMarkerHighlight:function(a){if(a._icon){var b=a._icon;b.style.display="none",L.DomUtil.hasClass(b,"leaflet-edit-marker-selected")?(L.DomUtil.removeClass(b,"leaflet-edit-marker-selected"),this._offsetMarker(b,-4)):(L.DomUtil.addClass(b,"leaflet-edit-marker-selected"),this._offsetMarker(b,4)),b.style.display=""}},_offsetMarker:function(a,b){var c=parseInt(a.style.marginTop,10)-b,d=parseInt(a.style.marginLeft,10)-b;a.style.marginTop=c+"px",a.style.marginLeft=d+"px"},_enableLayerEdit:function(a){var b,c=a.layer||a.target||a,d=c instanceof L.Marker;(!d||c._icon)&&(this._backupLayer(c),this._selectedPathOptions&&(b=L.Util.extend({},this._selectedPathOptions),d?this._toggleMarkerHighlight(c):(c.options.previousOptions=L.Util.extend({dashArray:null},c.options),c instanceof L.Circle||c instanceof L.Polygon||c instanceof L.Rectangle||(b.fill=!1),c.setStyle(b))),d?(c.dragging.enable(),c.on("dragend",this._onMarkerDragEnd)):(console.dir(c),c.editing.enable()))},_disableLayerEdit:function(a){var b=a.layer||a.target||a;b.edited=!1,this._selectedPathOptions&&(b instanceof L.Marker?this._toggleMarkerHighlight(b):(b.setStyle(b.options.previousOptions),delete b.options.previousOptions)),b instanceof L.Marker?(b.dragging.disable(),b.off("dragend",this._onMarkerDragEnd,this)):b.editing.disable()},_onMarkerDragEnd:function(a){var b=a.target;b.edited=!0},_hasAvailableLayers:function(){return 0!==this._featureGroup.getLayers().length}}),L.Edit=L.Edit||{},L.Edit.Poly=L.Handler.extend({options:{icon:new L.DivIcon({iconSize:new L.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"})},initialize:function(a,b){this._poly=a,L.setOptions(this,b)},addHooks:function(){this._poly._map&&(this._markerGroup||this._initMarkers(),this._poly._map.addLayer(this._markerGroup))},removeHooks:function(){this._poly._map&&(this._poly._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers)},updateMarkers:function(){this._markerGroup.clearLayers(),this._initMarkers()},_initMarkers:function(){this._markerGroup||(this._markerGroup=new L.LayerGroup),this._markers=[];var a,b,c,d,e=this._poly._latlngs;for(a=0,c=e.length;c>a;a++)d=this._createMarker(e[a],a),d.on("click",this._onMarkerClick,this),this._markers.push(d);var f,g;for(a=0,b=c-1;c>a;b=a++)(0!==a||L.Polygon&&this._poly instanceof L.Polygon)&&(f=this._markers[b],g=this._markers[a],this._createMiddleMarker(f,g),this._updatePrevNext(f,g))},_createMarker:function(a,b){var c=new L.Marker(a,{draggable:!0,icon:this.options.icon});return c._origLatLng=a,c._index=b,c.on("drag",this._onMarkerDrag,this),c.on("dragend",this._fireEdit,this),this._markerGroup.addLayer(c),c},_removeMarker:function(a){var b=a._index;this._markerGroup.removeLayer(a),this._markers.splice(b,1),this._poly.spliceLatLngs(b,1),this._updateIndexes(b,-1),a.off("drag",this._onMarkerDrag,this).off("dragend",this._fireEdit,this).off("click",this._onMarkerClick,this)},_fireEdit:function(){this._poly.edited=!0,this._poly.fire("edit")},_onMarkerDrag:function(a){var b=a.target;L.extend(b._origLatLng,b._latlng),b._middleLeft&&b._middleLeft.setLatLng(this._getMiddleLatLng(b._prev,b)),b._middleRight&&b._middleRight.setLatLng(this._getMiddleLatLng(b,b._next)),this._poly.redraw()},_onMarkerClick:function(a){var b=L.Polygon&&this._poly instanceof L.Polygon?4:3,c=a.target;this._poly._latlngs.length<b||(this._removeMarker(c),this._updatePrevNext(c._prev,c._next),c._middleLeft&&this._markerGroup.removeLayer(c._middleLeft),c._middleRight&&this._markerGroup.removeLayer(c._middleRight),c._prev&&c._next?this._createMiddleMarker(c._prev,c._next):c._prev?c._next||(c._prev._middleRight=null):c._next._middleLeft=null,this._fireEdit())},_updateIndexes:function(a,b){this._markerGroup.eachLayer(function(c){c._index>a&&(c._index+=b)})},_createMiddleMarker:function(a,b){var c,d,e,f=this._getMiddleLatLng(a,b),g=this._createMarker(f);g.setOpacity(.6),a._middleRight=b._middleLeft=g,d=function(){var d=b._index;g._index=d,g.off("click",c,this).on("click",this._onMarkerClick,this),f.lat=g.getLatLng().lat,f.lng=g.getLatLng().lng,this._poly.spliceLatLngs(d,0,f),this._markers.splice(d,0,g),g.setOpacity(1),this._updateIndexes(d,1),b._index++,this._updatePrevNext(a,g),this._updatePrevNext(g,b),this._poly.fire("editstart")},e=function(){g.off("dragstart",d,this),g.off("dragend",e,this),this._createMiddleMarker(a,g),this._createMiddleMarker(g,b)},c=function(){d.call(this),e.call(this),this._fireEdit()},g.on("click",c,this).on("dragstart",d,this).on("dragend",e,this),this._markerGroup.addLayer(g)},_updatePrevNext:function(a,b){a&&(a._next=b),b&&(b._prev=a)},_getMiddleLatLng:function(a,b){var c=this._poly._map,d=c.project(a.getLatLng()),e=c.project(b.getLatLng());return c.unproject(d._add(e)._divideBy(2))}}),L.Polyline.addInitHook(function(){this.editing||(L.Edit.Poly&&(this.editing=new L.Edit.Poly(this),this.options.editable&&this.editing.enable()),this.on("add",function(){this.editing&&this.editing.enabled()&&this.editing.addHooks()}),this.on("remove",function(){this.editing&&this.editing.enabled()&&this.editing.removeHooks()}))});